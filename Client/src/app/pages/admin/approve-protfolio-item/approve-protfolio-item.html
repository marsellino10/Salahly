<section class="approve-portfolio-page">
  <header class="page-hero">
    <div>
      <p class="eyebrow">{{ 'PortfolioApproval.PageHeader.Title' | translate }}</p>
      <h1>{{ 'PortfolioApproval.PageHeader.Subtitle' | translate }}</h1>
      <p class="subtitle">{{ 'PortfolioApproval.PageHeader.Description' | translate }}</p>
    </div>
    <button class="action ghost" type="button" (click)="loadInactivePortfolios()" [disabled]="loading">
      <span class="material-symbols-outlined"><i class="fa-solid fa-rotate"></i></span>
      {{ 'PortfolioApproval.PageHeader.RefreshList' | translate }}
    </button>
  </header>

  <section class="stats-panel">
    <article class="stat-card">
      <p class="label">{{ 'PortfolioApproval.Stats.PendingItems' | translate }}</p>
      <p class="value">{{ summary.total }}</p>
      <p class="hint">{{ 'PortfolioApproval.Stats.AwaitingApproval' | translate }}</p>
    </article>
    <article class="stat-card">
      <p class="label">{{ 'PortfolioApproval.Stats.ImpactedCraftsmen' | translate }}</p>
      <p class="value">{{ summary.craftsmanCount }}</p>
      <p class="hint">{{ 'PortfolioApproval.Stats.UniqueSubmitters' | translate }}</p>
    </article>
    <article class="stat-card">
      <p class="label">{{ 'PortfolioApproval.Stats.LongestWait' | translate }}</p>
      <p class="value">{{ summary.longestWaitingDays }}d</p>
      <p class="hint">{{ 'PortfolioApproval.Stats.SinceUpload' | translate }}</p>
    </article>
  </section>

  <section class="filters-panel">
    <div class="field search">
      <label for="portfolio-search">{{ 'PortfolioApproval.Filters.Search' | translate }}</label>
      <div class="input-wrapper">
        <span class="material-symbols-outlined"><i class="fa-solid fa-magnifying-glass"></i></span>
        <input
          id="portfolio-search"
          type="text"
          placeholder="{{ 'PortfolioApproval.Filters.SearchPlaceholder' | translate }}"
          [(ngModel)]="searchTerm"
          (ngModelChange)="applyFilters()"
        />
        <button
          class="clear"
          type="button"
          *ngIf="searchTerm"
          (click)="searchTerm=''; applyFilters()"
          [attr.aria-label]="'PortfolioApproval.Filters.ClearSearch' | translate"
        >
          <span class="material-symbols-outlined"><i class="fa-solid fa-xmark"></i></span>
        </button>
      </div>
    </div>

    <div class="field select">
      <label for="craftsman-filter">{{ 'PortfolioApproval.Filters.Craftsman' | translate }}</label>
      <select
        id="craftsman-filter"
        [(ngModel)]="selectedCraftsmanId"
        (ngModelChange)="applyFilters()"
      >
        <option value="all">{{ 'PortfolioApproval.Filters.All' | translate:{ count: summary.craftsmanCount } }}</option>
        <option *ngFor="let craftsmanId of craftsmanOptions" [value]="craftsmanId">
          #{{ craftsmanId }}
        </option>
      </select>
    </div>

    <div class="field select">
      <label for="sort-mode">{{ 'PortfolioApproval.Filters.SortBy' | translate }}</label>
      <select id="sort-mode" [(ngModel)]="sortMode" (ngModelChange)="applyFilters()">
        <option value="newest">{{ 'PortfolioApproval.Filters.NewestFirst' | translate }}</option>
        <option value="oldest">{{ 'PortfolioApproval.Filters.OldestFirst' | translate }}</option>
        <option value="title">{{ 'PortfolioApproval.Filters.TitleAZ' | translate }}</option>
      </select>
    </div>

    <button class="action tertiary" type="button" (click)="clearFilters()" [disabled]="!searchTerm && selectedCraftsmanId==='all' && sortMode==='newest'">
      {{ 'PortfolioApproval.Filters.ResetFilters' | translate }}
    </button>
  </section>

  <div class="feedback" *ngIf="errorMessage || successMessage">
    <p class="alert error" *ngIf="errorMessage">
      <span class="material-symbols-outlined"><i class="fa-solid fa-circle-exclamation"></i></span>
      {{ errorMessage }}
    </p>
    <p class="alert success" *ngIf="successMessage">
      <span class="material-symbols-outlined"><i class="fa-solid fa-circle-check"></i></span>
      {{ successMessage }}
    </p>
  </div>

  <section class="portfolio-grid" *ngIf="!loading && filteredItems.length">
    <article class="portfolio-card" *ngFor="let item of filteredItems; trackBy: trackById">
      <header class="card-header">
        <div>
          <p class="card-title">{{ item.title }}</p>
          <p class="card-meta">#{{ item.id }} â€¢ Uploaded {{ formatFullDate(item.createdAt) }}</p>
        </div>
        <span class="chip waiting">{{ formatRelativeDate(item.createdAt) }}</span>
      </header>

      <div class="card-body">
        <figure class="preview">
          <img [src]="item.imageUrl || 'assets/images/portfolio-placeholder.svg'" [alt]="item.title" loading="lazy" />
        </figure>
        <div class="details">
          <p class="description">{{ item.description || ('PortfolioApproval.Card.NoDescription' | translate) }}</p>
          <div class="meta-grid">
            <div>
              <p class="meta-label">{{ 'PortfolioApproval.Card.Craftsman' | translate }}</p>
              <p class="meta-value">#{{ item.craftsmanId }}</p>
            </div>
            <div>
              <p class="meta-label">{{ 'PortfolioApproval.Card.DisplayOrder' | translate }}</p>
              <p class="meta-value">{{ item.displayOrder }}</p>
            </div>
            <div>
              <p class="meta-label">{{ 'PortfolioApproval.Card.Status' | translate }}</p>
              <p class="meta-value warning">{{ 'PortfolioApproval.Card.Inactive' | translate }}</p>
            </div>
          </div>
        </div>
      </div>

      <footer class="card-actions">
        <button
          type="button"
          class="action primary"
          (click)="approveItem(item)"
          [disabled]="approvingId === item.id"
        >
          <i class="bi bi-check2-all"></i>
          {{ approvingId === item.id ? ('PortfolioApproval.Card.Approving' | translate) : ('PortfolioApproval.Card.ApproveItem' | translate) }}
        </button>
        <button type="button" class="action ghost" [routerLink]="['/technicians', item.craftsmanId, 'profile']" [disabled]="approvingId === item.id">
          <i class="bi bi-eye-fill"></i>
          {{ 'PortfolioApproval.Card.PreviewFullPortfolio' | translate }}
        </button>
      </footer>
    </article>
  </section>

  <section class="skeleton-grid" *ngIf="loading">
    <div class="skeleton-card" *ngFor="let _ of skeletonPlaceholders">
      <div class="skeleton title"></div>
      <div class="skeleton meta"></div>
      <div class="skeleton image"></div>
      <div class="skeleton text"></div>
      <div class="skeleton text short"></div>
    </div>
  </section>

  <section class="empty-state" *ngIf="!loading && !filteredItems.length">
    <span class="material-symbols-outlined"><i class="fa-solid fa-face-smile"></i></span>
    <h2>{{ 'PortfolioApproval.EmptyState.Title' | translate }}</h2>
    <p>{{ 'PortfolioApproval.EmptyState.Description' | translate }}</p>
    <button class="action ghost" type="button" (click)="loadInactivePortfolios()">
      {{ 'PortfolioApproval.EmptyState.Refresh' | translate }}
    </button>
  </section>
</section>
