<div class="chatbot-widget">
  <button
    class="chat-launch"
    type="button"
    (click)="togglePanel()"
    aria-label="Open support chat"
  >
    <span class="launch-icon" aria-hidden="true">ðŸ’¬</span>
  </button>

  <div
    class="chat-panel"
    [class.open]="isPanelOpen()"
    [class.minimized]="isMinimized()"
    role="dialog"
    aria-modal="false"
    aria-label="Salahly support chatbot"
  >
    <div class="chat-header">
      <div class="chat-title">
        <div class="chat-avatar">S</div>
        <div>
          <h2>Salahly Assistant</h2>
          <p>Here to answer your questions</p>
        </div>
      </div>
      <div class="chat-controls">
        <button
          type="button"
          class="icon-button"
          (click)="toggleMinimize()"
          [attr.aria-label]="isMinimized() ? 'Restore chat' : 'Minimize chat'"
        >
          <span aria-hidden="true">{{ isMinimized() ? 'â–¢' : 'â€”' }}</span>
        </button>
        <button
          type="button"
          class="icon-button"
          (click)="closePanel()"
          aria-label="Close chat"
        >
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
    </div>

    <div class="chat-body" *ngIf="!isMinimized()">
      <div class="messages" #messagesContainer>
        <div
          class="message"
          [class.user]="message.role === 'user'"
          [class.assistant]="message.role === 'assistant'"
          *ngFor="let message of messages(); trackBy: trackByIndex"
        >
          <div class="bubble">
            <p>{{ message.content }}</p>
            <span class="timestamp">{{ message.timestamp | date: 'shortTime' }}</span>
          </div>
        </div>
      </div>

      <div class="status" *ngIf="errorMessage()">
        <span class="error-text">{{ errorMessage() }}</span>
      </div>

      <form class="composer" (ngSubmit)="sendMessage()">
        <textarea
          name="message"
          [ngModel]="messageDraft()"
          (ngModelChange)="messageDraft.set($event)"
          (keydown)="onKeyDown($event)"
          rows="2"
          placeholder="Ask about booking, login help, or anything else..."
          [disabled]="isSending()"
        ></textarea>
        <button type="submit" [disabled]="isSending() || !messageDraft().trim()">
          <span *ngIf="!isSending()">Send</span>
          <span *ngIf="isSending()" class="spinner" aria-hidden="true"></span>
        </button>
      </form>
    </div>
  </div>
</div>
