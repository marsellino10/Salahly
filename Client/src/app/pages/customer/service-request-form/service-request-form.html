<section class="request-form-page">
  <header class="page-hero glass-panel">
    <div class="hero-copy">
      <button type="button" class="ghost-btn" (click)="navigateBack()">
        <i class="bi bi-arrow-left"></i>
        {{ 'ServiceRequestForm.Hero.Back' | translate }}
      </button>
      <p class="eyebrow">{{ 'ServiceRequestForm.Hero.Eyebrow' | translate }}</p>
      <h1>{{ 'ServiceRequestForm.Hero.Title' | translate }}</h1>
      <p class="lead">{{ 'ServiceRequestForm.Hero.Lead' | translate }}</p>
      <div class="hero-actions">
        <a routerLink="/show-services-requested" class="ghost-link">{{ 'ServiceRequestForm.Hero.ViewExisting' | translate }}</a>
        <div class="chip">
          {{ 'ServiceRequestForm.Hero.PhotoChip' | translate:{ max: maxImages, selected: selectedImages.length } }}
        </div>
      </div>
    </div>

    <div class="hero-stats">
      <article class="stat-card">
        <p class="label">{{ 'ServiceRequestForm.Hero.Stats.StepLabel' | translate:{ step: 1 } }}</p>
        <h3>{{ 'ServiceRequestForm.Hero.Stats.Step1Title' | translate }}</h3>
        <p class="muted">{{ 'ServiceRequestForm.Hero.Stats.Step1Subtitle' | translate }}</p>
      </article>
      <article class="stat-card">
        <p class="label">{{ 'ServiceRequestForm.Hero.Stats.StepLabel' | translate:{ step: 2 } }}</p>
        <h3>{{ 'ServiceRequestForm.Hero.Stats.Step2Title' | translate }}</h3>
        <p class="muted">{{ 'ServiceRequestForm.Hero.Stats.Step2Subtitle' | translate }}</p>
      </article>
      <article class="stat-card">
        <p class="label">{{ 'ServiceRequestForm.Hero.Stats.StepLabel' | translate:{ step: 3 } }}</p>
        <h3>{{ 'ServiceRequestForm.Hero.Stats.Step3Title' | translate }}</h3>
        <p class="muted">{{ 'ServiceRequestForm.Hero.Stats.Step3Subtitle' | translate }}</p>
      </article>
    </div>
  </header>

  <div *ngIf="submitSuccess" class="banner success glass-panel">
    <div>
      <p class="eyebrow">{{ 'ServiceRequestForm.Banners.SuccessTitle' | translate }}</p>
      <p>{{ submitSuccess }}</p>
    </div>
    <button type="button" class="ghost-btn" (click)="submitSuccess = null">{{ 'ServiceRequestForm.Banners.Dismiss' | translate }}</button>
  </div>

  <div *ngIf="submitError" class="banner error glass-panel">
    <div>
      <p class="eyebrow">{{ 'ServiceRequestForm.Banners.ErrorTitle' | translate }}</p>
      <p>{{ submitError }}</p>
    </div>
    <button type="button" class="ghost-btn" (click)="submitError = null">{{ 'ServiceRequestForm.Banners.Dismiss' | translate }}</button>
  </div>

  <form class="request-form glass-panel" [formGroup]="requestForm" (ngSubmit)="submitRequest()" novalidate>
    <section class="form-section">
      <div class="section-head">
        <div>
          <p class="eyebrow">{{ 'ServiceRequestForm.Sections.Overview.Eyebrow' | translate }}</p>
          <h2>{{ 'ServiceRequestForm.Sections.Overview.Title' | translate }}</h2>
        </div>
        <small>{{ 'ServiceRequestForm.Sections.Overview.RequiredHint' | translate }}</small>
      </div>

      <div class="field-grid two-col">
        <label class="input-shell" [class.invalid]="fieldInvalid('craftId')">
          <span>{{ 'ServiceRequestForm.Fields.CraftLabel' | translate }}</span>
          <select formControlName="craftId" [disabled]="isLoadingCrafts">
            <option value="" disabled selected>{{ 'ServiceRequestForm.Fields.CraftPlaceholder' | translate }}</option>
            <option *ngFor="let craft of crafts" [value]="craft.id">{{ craft.name }}</option>
          </select>
          <small class="muted" *ngIf="isLoadingCrafts">{{ 'ServiceRequestForm.Loading.Crafts' | translate }}</small>
          <small class="error-text" *ngIf="craftsError">{{ craftsError }}</small>
          <small class="error-text" *ngIf="fieldInvalid('craftId')">{{ 'ServiceRequestForm.Errors.CraftRequired' | translate }}</small>
        </label>

        <label class="input-shell" [class.invalid]="fieldInvalid('title')">
          <span>{{ 'ServiceRequestForm.Fields.TitleLabel' | translate }}</span>
          <input type="text" formControlName="title" [placeholder]="'ServiceRequestForm.Fields.TitlePlaceholder' | translate" maxlength="80" />
          <div class="helper-row">
            <small>{{ 'ServiceRequestForm.Fields.TitleCounter' | translate:{ used: titleLength, max: 80 } }}</small>
          </div>
          <small class="error-text" *ngIf="fieldInvalid('title')">{{ 'ServiceRequestForm.Errors.TitleInvalid' | translate }}</small>
        </label>
      </div>

      <label class="input-shell" [class.invalid]="fieldInvalid('description')">
        <span>{{ 'ServiceRequestForm.Fields.DescriptionLabel' | translate }}</span>
        <textarea
          rows="5"
          formControlName="description"
          [placeholder]="'ServiceRequestForm.Fields.DescriptionPlaceholder' | translate"
          maxlength="800"
        ></textarea>
        <div class="helper-row">
          <small>{{ 'ServiceRequestForm.Fields.DescriptionCounter' | translate:{ used: descriptionLength, max: 800 } }}</small>
        </div>
        <small class="error-text" *ngIf="fieldInvalid('description')">
          {{ 'ServiceRequestForm.Errors.DescriptionInvalid' | translate }}
        </small>
      </label>
    </section>

    <section class="form-section">
      <div class="section-head">
        <div>
          <p class="eyebrow">{{ 'ServiceRequestForm.Sections.Schedule.Eyebrow' | translate }}</p>
          <h2>{{ 'ServiceRequestForm.Sections.Schedule.Title' | translate }}</h2>
        </div>
      </div>

      <div class="field-grid three-col">
        <label class="input-shell" [class.invalid]="fieldInvalid('areaId')">
          <span>{{ 'ServiceRequestForm.Fields.AreaLabel' | translate }}</span>
          <select formControlName="areaId" [disabled]="isLoadingAreas">
            <option value="" disabled selected>{{ 'ServiceRequestForm.Fields.AreaPlaceholder' | translate }}</option>
            <option *ngFor="let area of areas" [value]="area.id">
              {{ area.city }} â€¢ {{ area.region }}
            </option>
          </select>
          <small class="muted" *ngIf="isLoadingAreas">{{ 'ServiceRequestForm.Loading.Areas' | translate }}</small>
          <small class="error-text" *ngIf="areasError">{{ areasError }}</small>
          <small class="error-text" *ngIf="fieldInvalid('areaId')">{{ 'ServiceRequestForm.Errors.AreaRequired' | translate }}</small>
        </label>

        <label class="input-shell" [class.invalid]="fieldInvalid('availableFromDate')">
          <span>{{ 'ServiceRequestForm.Fields.AvailableFromLabel' | translate }}</span>
          <input type="date" formControlName="availableFromDate" [attr.min]="minDate" />
          <small class="muted">{{ 'ServiceRequestForm.Fields.AvailableFromHint' | translate }}</small>
          <small class="error-text" *ngIf="fieldInvalid('availableFromDate')">{{ 'ServiceRequestForm.Errors.AvailableFromRequired' | translate }}</small>
        </label>

        <label class="input-shell" [class.invalid]="fieldInvalid('availableToDate')">
          <span>{{ 'ServiceRequestForm.Fields.AvailableToLabel' | translate }}</span>
          <input type="date" formControlName="availableToDate" [attr.min]="minDate" />
          <small class="muted">{{ 'ServiceRequestForm.Fields.AvailableToHint' | translate }}</small>
          <small class="error-text" *ngIf="fieldInvalid('availableToDate')">{{ 'ServiceRequestForm.Errors.AvailableToRequired' | translate }}</small>
        </label>
      </div>

      <label class="input-shell full-width" [class.invalid]="fieldInvalid('address')">
        <span>{{ 'ServiceRequestForm.Fields.AddressLabel' | translate }}</span>
        <input type="text" formControlName="address" [placeholder]="'ServiceRequestForm.Fields.AddressPlaceholder' | translate" maxlength="160" />
        <small class="error-text" *ngIf="fieldInvalid('address')">{{ 'ServiceRequestForm.Errors.AddressRequired' | translate }}</small>
      </label>

      <div class="field-grid two-col">
        <label class="input-shell">
          <span>{{ 'ServiceRequestForm.Fields.LatitudeLabel' | translate }}</span>
          <input type="number" step="0.0001" formControlName="latitude" [placeholder]="'ServiceRequestForm.Fields.LatitudePlaceholder' | translate" />
        </label>
        <label class="input-shell">
          <span>{{ 'ServiceRequestForm.Fields.LongitudeLabel' | translate }}</span>
          <input type="number" step="0.0001" formControlName="longitude" [placeholder]="'ServiceRequestForm.Fields.LongitudePlaceholder' | translate" />
        </label>
      </div>
    </section>

    <section class="form-section">
      <div class="section-head">
        <div>
          <p class="eyebrow">{{ 'ServiceRequestForm.Sections.Budget.Eyebrow' | translate }}</p>
          <h2>{{ 'ServiceRequestForm.Sections.Budget.Title' | translate }}</h2>
        </div>
      </div>

      <div class="field-grid three-col">
        <label class="input-shell">
          <span>{{ 'ServiceRequestForm.Fields.BudgetLabel' | translate }}</span>
          <input type="number" min="20" step="10" formControlName="customerBudget" [placeholder]="'ServiceRequestForm.Fields.BudgetPlaceholder' | translate" />
          <small class="muted">{{ 'ServiceRequestForm.Fields.BudgetHint' | translate }}</small>
        </label>

        <label class="input-shell">
          <span>{{ 'ServiceRequestForm.Fields.MaxOffersLabel' | translate }}</span>
          <input type="number" min="1" max="10" step="1" formControlName="maxOffers" />
          <small class="muted">{{ 'ServiceRequestForm.Fields.MaxOffersHint' | translate }}</small>
        </label>
      </div>
    </section>

    <section class="form-section">
      <div class="section-head">
        <div>
          <p class="eyebrow">{{ 'ServiceRequestForm.Sections.Photos.Eyebrow' | translate }}</p>
          <h2>{{ 'ServiceRequestForm.Sections.Photos.Title' | translate }}</h2>
        </div>
        <small *ngIf="selectedImages.length">{{ 'ServiceRequestForm.Upload.CountLabel' | translate:{ uploaded: selectedImages.length, max: maxImages } }}</small>
      </div>
          <img src="" alt="">

      <div class="upload-card">
        <input type="file" accept="image/*" multiple (change)="onFilesSelected($event)" [disabled]="selectedImages.length >= maxImages" />
        <div>
          <h3>{{ 'ServiceRequestForm.Upload.Heading' | translate }}</h3>
          <p class="muted">{{ 'ServiceRequestForm.Upload.Hint' | translate:{ max: maxImages } }}</p>
        </div>
        <button type="button" class="ghost-btn" (click)="clearUploads()" [disabled]="!selectedImages.length">
          {{ 'ServiceRequestForm.Upload.ClearAll' | translate }}
        </button>
      </div>

      <div class="upload-grid" *ngIf="imagePreviews.length">
        <figure class="upload-preview" *ngFor="let preview of imagePreviews; let i = index">
          <img [src]="preview" [attr.alt]="('ServiceRequestForm.Upload.PreviewAlt' | translate:{ index: i + 1 })" />
          <button type="button" class="icon-btn" (click)="removeImage(i)">
            <i class="bi bi-x-lg"></i>
          </button>
        </figure>
      </div>
    </section>

    <footer class="form-footer">
      <div>
        <p class="muted">{{ 'ServiceRequestForm.Footer.Line1' | translate }}</p>
        <p class="muted">{{ 'ServiceRequestForm.Footer.Line2' | translate }}</p>
      </div>
      <button type="submit" class="primary-btn" [disabled]="isSubmitting">
        <ng-container *ngIf="isSubmitting; else submitLabel">{{ 'ServiceRequestForm.Buttons.Submitting' | translate }}</ng-container>
        <ng-template #submitLabel>{{ 'ServiceRequestForm.Buttons.Submit' | translate }}</ng-template>
      </button>
    </footer>
  </form>
</section>